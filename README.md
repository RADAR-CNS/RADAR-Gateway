# RADAR-Gateway

[![Build Status](https://travis-ci.org/RADAR-base/RADAR-Gateway.svg?branch=master)](https://travis-ci.org/RADAR-base/RADAR-Gateway)
[![Codacy Badge](https://api.codacy.com/project/badge/Grade/79b2380112c5451181367ae16e112025)](https://www.codacy.com/app/RADAR-base/RADAR-Gateway?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=RADAR-base/RADAR-Gateway&amp;utm_campaign=Badge_Grade)
[![Docker Build](https://img.shields.io/docker/build/radarbase/radar-gateway.svg)](https://cloud.docker.com/swarm/radarbase/repository/docker/radarbase/radar-gateway/general)

Gateway to the Confluent Kafka REST Proxy. It does the authentication and authorization, content 
validation and decompression if needed. It is available as a [docker image](https://hub.docker.com/r/radarbase/radar-gateway).

## Configuration

The [RADAR-Auth] library is used for authentication and authorization of users. Refer to the documentation there for a full description of the configuration options.

## Usage

Start the REST Proxy with

```shell
docker-compose -f src/integrationTest/docker/docker-compose.yml up -d
./gradlew run
```

Now the gateway is accessible through <http://localhost:8090/radar-gateway/> and the [ManagementPortal] is available through <http://localhost:8080/managementportal/>

Now you can access the REST proxy via the gateway:
```shell
curl -H 'Authorization: Bearer myAccessToken' http://localhost:8090/radar-gateway/topics
```

The access token should be generated by the aforementioned Management portal. The gateway does content validation for posted data. It requires to use the Avro format with JSON serialization, using the `application/vnd.kafka.avro.v1+json` or `application/vnd.kafka.avro.v2+json` media types, as described in the [REST Proxy documentation].  It also requires messages to have both a key and a value with schemas. The key should have a `userId` and `sourceId` field. The `userId` should match the `sub` field in the OAuth2 JWT access token. That JWT should also contain a `sources` array claim which should contain the given `sourceId`. Sources can be added in the ManagementPortal or be generated by the app dynamically and then registered with the ManagementPortal.

Data compressed with GZIP is decompressed if the `Content-Encoding: gzip` header is provided. With
`curl`, use the `-H "Content-Encoding: gzip" --data-binary @data.json.gz` flags. Likewise it accepts Apple LZFSE encoded data by adding the header `Content-Encoding: lzfse`

Otherwise, it accepts all the same Avro messages and headers as specified in the Kafka [REST Proxy documentation].

[REST Proxy documentation]: https://docs.confluent.io/current/kafka-rest/api.html
[RADAR-Auth]: https://github.com/RADAR-base/ManagementPortal/tree/master/radar-auth
[ManagementPortal]: https://github.com/RADAR-base/ManagementPortal
